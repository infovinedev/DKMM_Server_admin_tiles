<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.infovine.dkmm.mapper.userLeave.TUserLeaveMapper">
  <resultMap id="BaseResultMap" type="kr.co.infovine.dkmm.db.model.userLeave.TUserLeave">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 05 09:42:32 KST 2022.
    -->
    <id column="leave_seq" jdbcType="INTEGER" property="leaveSeq" />
    <result column="user_seq" jdbcType="BIGINT" property="userSeq" />
    
    <result column="nick_name" jdbcType="BIGINT" property="nickName" />
    <result column="user_id" jdbcType="BIGINT" property="userId" />
    <result column="del_yn" jdbcType="BIGINT" property="delYn" />
    
    
    <result column="reason" jdbcType="VARCHAR" property="reason" />
    <result column="ins_dt" jdbcType="TIMESTAMP" property="insDt" />
    <result column="approval_yn" jdbcType="VARCHAR" property="approvalYn" />
    <result column="upt_seq" jdbcType="BIGINT" property="uptSeq" />
    <result column="upt_dt" jdbcType="TIMESTAMP" property="uptDt" />
    <result column="ins_seq" jdbcType="BIGINT" property="insSeq" />
  </resultMap>
  
  <sql id="searchCondition_leave">
    <if test='searchStartDt neq null and !"".equals(searchStartDt)'>
       AND TO_CHAR(ins_dt, 'YYYY-MM-DD') BETWEEN #{searchStartDt} AND #{searchEndDt}
    </if>
    <if test='delYn neq null and !"".equals(delYn)'>
       AND (SELECT del_yn FROM t_user_info WHERE user_seq = a.user_seq) = #{delYn}
    </if>
    <if test='searchText neq null and !"".equals(searchText)'>
       AND reason LIKE CONCAT('%', #{searchText}, '%') OR (SELECT nick_name FROM t_user_info WHERE user_seq = a.user_seq) LIKE CONCAT('%', #{searchText}, '%')
    </if>
  </sql>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 05 09:42:32 KST 2022.
    -->
    delete from t_user_leave
    where leave_seq = #{leaveSeq,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="kr.co.infovine.dkmm.db.model.userLeave.TUserLeave">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 05 09:42:32 KST 2022.
    -->
    insert into t_user_leave (leave_seq, user_seq, reason, 
      ins_dt, approval_yn, upt_seq, 
      upt_dt, ins_seq)
    values (#{leaveSeq,jdbcType=INTEGER}, #{userSeq,jdbcType=BIGINT}, #{reason,jdbcType=VARCHAR}, 
      #{insDt,jdbcType=TIMESTAMP}, #{approvalYn,jdbcType=VARCHAR}, #{uptSeq,jdbcType=BIGINT}, 
      #{uptDt,jdbcType=TIMESTAMP}, #{insSeq,jdbcType=BIGINT})
  </insert>
  <update id="updateByPrimaryKey" parameterType="kr.co.infovine.dkmm.db.model.userLeave.TUserLeave">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 05 09:42:32 KST 2022.
    -->
    update t_user_leave
    set user_seq = #{userSeq,jdbcType=BIGINT},
      reason = #{reason,jdbcType=VARCHAR},
      ins_dt = #{insDt,jdbcType=TIMESTAMP},
      approval_yn = #{approvalYn,jdbcType=VARCHAR},
      upt_seq = #{uptSeq,jdbcType=BIGINT},
      upt_dt = #{uptDt,jdbcType=TIMESTAMP},
      ins_seq = #{insSeq,jdbcType=BIGINT}
    where leave_seq = #{leaveSeq,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 05 09:42:32 KST 2022.
    -->
    select leave_seq, user_seq, reason, ins_dt, approval_yn, upt_seq, upt_dt, ins_seq
    from t_user_leave
    where leave_seq = #{leaveSeq,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 05 09:42:32 KST 2022.
    -->
    select leave_seq, user_seq, reason, ins_dt, approval_yn, upt_seq, upt_dt, ins_seq
    from t_user_leave
  </select>
  
  <select id="selectAllUserLeave" parameterType="kr.co.infovine.dkmm.db.model.userLeave.TUserLeave" resultMap="BaseResultMap">
    SELECT
         ROW_NUMBER() OVER() AS rowNum
        ,a.leave_seq
        ,(SELECT user_id FROM t_user_info WHERE user_seq = a.user_seq) as user_id
        ,(SELECT nick_name FROM t_user_info WHERE user_seq = a.user_seq) as nick_name
        ,a.reason
        ,TO_CHAR(a.ins_dt, 'YYYY-MM-DD HH:MI') as ins_dt
        ,a.approval_yn
        ,(SELECT del_yn FROM t_user_info WHERE user_seq = a.user_seq) as del_yn
      FROM t_user_leave a
      WHERE 1=1
     <include refid="searchCondition_leave"></include>
     ORDER BY leave_seq DESC
  </select>
  <select id="selectUserLeaveDetail" parameterType="kr.co.infovine.dkmm.db.model.userLeave.TUserLeave" resultMap="BaseResultMap">
       SELECT
      a.leave_seq
      ,(SELECT user_id FROM t_user_info WHERE user_seq = a.user_seq) as user_id
      ,a.reason
      ,(SELECT nick_name FROM t_user_info WHERE user_seq = a.user_seq) as nick_name
      ,TO_CHAR(a.ins_dt, 'YYYY-MM-DD HH:MI') as ins_dt
      ,TO_CHAR(a.upt_dt, 'YYYY-MM-DD HH:MI') as upt_dt
      ,a.approval_yn
      ,(SELECT del_yn FROM t_user_info WHERE user_seq = a.user_seq) as del_yn
      FROM t_user_leave a
    WHERE 1=1
    AND a.leave_seq = ${leaveSeq}
  </select>
  
</mapper>