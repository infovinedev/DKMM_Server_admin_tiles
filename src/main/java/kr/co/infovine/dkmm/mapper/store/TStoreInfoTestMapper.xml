<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.infovine.dkmm.mapper.store.TStoreInfoTestMapper">
  <resultMap id="BaseResultMap" type="kr.co.infovine.dkmm.db.model.store.TStoreInfoModelTest">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 22 16:52:13 KST 2022.
    -->
    <id column="store_seq" jdbcType="BIGINT" property="storeSeq" />
    <result column="store_mngt_no" jdbcType="VARCHAR" property="storeMngtNo" />
    <result column="store_nm" jdbcType="VARCHAR" property="storeNm" />
    <result column="ctgry_nm" jdbcType="VARCHAR" property="ctgryNm" />
    <result column="road_addr" jdbcType="VARCHAR" property="roadAddr" />
    <result column="road_zip" jdbcType="VARCHAR" property="roadZip" />
    <result column="latitude" jdbcType="VARCHAR" property="latitude" />
    <result column="longitude" jdbcType="VARCHAR" property="longitude" />
    <result column="company_no" jdbcType="VARCHAR" property="companyNo" />
    <result column="store_open_time" jdbcType="VARCHAR" property="storeOpenTime" />
    <result column="store_end_time" jdbcType="VARCHAR" property="storeEndTime" />
    <result column="store_holiday_type" jdbcType="VARCHAR" property="storeHolidayType" />
    <result column="max_cnt" jdbcType="VARCHAR" property="maxCnt" />
    <result column="file_uuid" jdbcType="VARCHAR" property="fileUuid" />
    <result column="use_yn" jdbcType="VARCHAR" property="useYn" />
    <result column="del_yn" jdbcType="VARCHAR" property="delYn" />
    <result column="ins_seq" jdbcType="BIGINT" property="insSeq" />
    <result column="ins_dt" jdbcType="TIMESTAMP" property="insDt" />
    <result column="upt_seq" jdbcType="BIGINT" property="uptSeq" />
    <result column="upt_dt" jdbcType="TIMESTAMP" property="uptDt" />
    <result column="store_tel" jdbcType="VARCHAR" property="storeTel" />
    <result column="area_tot" jdbcType="VARCHAR" property="areaTot" />
    <result column="priority" jdbcType="INTEGER" property="priority" />
    <result column="like_cnt" jdbcType="BIGINT" property="likeCnt" />
    <result column="last_wait_user_seq" jdbcType="BIGINT" property="lastWaitUserSeq" />
    <result column="last_wait_person_cnt" jdbcType="INTEGER" property="lastWaitPersonCnt" />
    <result column="last_wait_ins_dt" jdbcType="TIMESTAMP" property="lastWaitInsDt" />
    <result column="old_addr" jdbcType="VARCHAR" property="oldAddr" />
    <result column="old_zip" jdbcType="VARCHAR" property="oldZip" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 22 16:52:13 KST 2022.
    -->
    delete from t_store_info_test
    where store_seq = #{storeSeq,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="kr.co.infovine.dkmm.db.model.store.TStoreInfoModelTest">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 22 16:52:13 KST 2022.
    -->
    insert into t_store_info_test (store_seq, store_mngt_no, store_nm, 
      ctgry_nm, road_addr, road_zip, 
      latitude, longitude, company_no, 
      store_open_time, store_end_time, store_holiday_type, 
      max_cnt, file_uuid, use_yn, 
      del_yn, ins_seq, ins_dt, 
      upt_seq, upt_dt, store_tel, 
      area_tot, priority, like_cnt, 
      last_wait_user_seq, last_wait_person_cnt, last_wait_ins_dt, 
      old_addr, old_zip)
    values (#{storeSeq,jdbcType=BIGINT}, #{storeMngtNo,jdbcType=VARCHAR}, #{storeNm,jdbcType=VARCHAR}, 
      #{ctgryNm,jdbcType=VARCHAR}, #{roadAddr,jdbcType=VARCHAR}, #{road_zip,jdbcType=VARCHAR}, 
      #{latitude,jdbcType=VARCHAR}, #{longitude,jdbcType=VARCHAR}, #{companyNo,jdbcType=VARCHAR}, 
      #{storeOpenTime,jdbcType=VARCHAR}, #{storeEndTime,jdbcType=VARCHAR}, #{storeHolidayType,jdbcType=VARCHAR}, 
      #{maxCnt,jdbcType=VARCHAR}, #{fileUuid,jdbcType=VARCHAR}, #{useYn,jdbcType=VARCHAR}, 
      #{delYn,jdbcType=VARCHAR}, #{insSeq,jdbcType=BIGINT}, #{insDt,jdbcType=TIMESTAMP}, 
      #{uptSeq,jdbcType=BIGINT}, #{uptDt,jdbcType=TIMESTAMP}, #{storeTel,jdbcType=VARCHAR}, 
      #{areaTot,jdbcType=VARCHAR}, #{priority,jdbcType=INTEGER}, #{likeCnt,jdbcType=BIGINT}, 
      #{lastWaitUserSeq,jdbcType=BIGINT}, #{lastWaitPersonCnt,jdbcType=INTEGER}, #{lastWaitInsDt,jdbcType=TIMESTAMP}, 
      #{oldAddr,jdbcType=VARCHAR}, #{oldZip,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="kr.co.infovine.dkmm.db.model.store.TStoreInfoModelTest">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 22 16:52:13 KST 2022.
    -->
    update t_store_info_test
    set store_mngt_no = #{storeMngtNo,jdbcType=VARCHAR},
      store_nm = #{storeNm,jdbcType=VARCHAR},
      ctgry_nm = #{ctgryNm,jdbcType=VARCHAR},
      road_addr = #{roadAddr,jdbcType=VARCHAR},
      road_zip = #{road_zip,jdbcType=VARCHAR},
      latitude = #{latitude,jdbcType=VARCHAR},
      longitude = #{longitude,jdbcType=VARCHAR},
      company_no = #{companyNo,jdbcType=VARCHAR},
      store_open_time = #{storeOpenTime,jdbcType=VARCHAR},
      store_end_time = #{storeEndTime,jdbcType=VARCHAR},
      store_holiday_type = #{storeHolidayType,jdbcType=VARCHAR},
      max_cnt = #{maxCnt,jdbcType=VARCHAR},
      file_uuid = #{fileUuid,jdbcType=VARCHAR},
      use_yn = #{useYn,jdbcType=VARCHAR},
      del_yn = #{delYn,jdbcType=VARCHAR},
      ins_seq = #{insSeq,jdbcType=BIGINT},
      ins_dt = #{insDt,jdbcType=TIMESTAMP},
      upt_seq = #{uptSeq,jdbcType=BIGINT},
      upt_dt = #{uptDt,jdbcType=TIMESTAMP},
      store_tel = #{storeTel,jdbcType=VARCHAR},
      area_tot = #{areaTot,jdbcType=VARCHAR},
      priority = #{priority,jdbcType=INTEGER},
      like_cnt = #{likeCnt,jdbcType=BIGINT},
      last_wait_user_seq = #{lastWaitUserSeq,jdbcType=BIGINT},
      last_wait_person_cnt = #{lastWaitPersonCnt,jdbcType=INTEGER},
      last_wait_ins_dt = #{lastWaitInsDt,jdbcType=TIMESTAMP},
      old_addr = #{oldAddr,jdbcType=VARCHAR},
      old_zip = #{oldZip,jdbcType=VARCHAR}
    where store_seq = #{storeSeq,jdbcType=BIGINT}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 22 16:52:13 KST 2022.
    -->
    select store_seq, store_mngt_no, store_nm, ctgry_nm, road_addr, road_zip, latitude, longitude, 
    company_no, store_open_time, store_end_time, store_holiday_type, max_cnt, file_uuid, 
    use_yn, del_yn, ins_seq, ins_dt, upt_seq, upt_dt, store_tel, area_tot, priority, 
    like_cnt, last_wait_user_seq, last_wait_person_cnt, last_wait_ins_dt, old_addr, old_zip
    from t_store_info_test
    where store_seq = #{storeSeq,jdbcType=BIGINT}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 22 16:52:13 KST 2022.
    -->
    select store_seq, store_mngt_no, store_nm, ctgry_nm, road_addr, road_zip, latitude, longitude, 
    company_no, store_open_time, store_end_time, store_holiday_type, max_cnt, file_uuid, 
    use_yn, del_yn, ins_seq, ins_dt, upt_seq, upt_dt, store_tel, area_tot, priority, 
    like_cnt, last_wait_user_seq, last_wait_person_cnt, last_wait_ins_dt, old_addr, old_zip
    from t_store_info_test
  </select>
  
  <insert id="mergeStoreInfo" >
  	/* TStoreInfoTest.mergeStoreInfo   STORE_INFO 정보 update */
  	INSERT INTO t_store_info_test				
	(                                       
    	 store_mngt_no                      
		,store_nm                           
		,ctgry_nm                           
		,road_addr                          
		,road_zip                                
		,old_addr                           
		,old_zip                            
		,ins_seq                            
		,upt_seq                            
		,store_tel                          
		,area_tot                           
	)                                       
	SELECT                                  
		manage_no as store_mngt_no          
		,store_nm as store_nm               
		,ctgry_nm as ctgry_nm               
		,road_addr as road_addr             
		,road_zip as road_zip                    
		,addr as old_addr              
		,zip as old_zip                
		,0 as ins_seq                       
		,0 as upt_seq                       
		,tel as store_tel                   
		,area_tot                           
	FROM t_store_info_org                   
	WHERE status_type = '01'                
	AND   process_yn = 'N'                  
	ON CONFLICT (store_mngt_no) DO UPDATE   
    SET                                     
    	road_addr = excluded.road_addr      
    	,road_zip = excluded.road_zip                 
    	,store_tel = excluded.store_tel     
    	,old_addr = excluded.old_addr       
    	,old_zip = excluded.old_zip  
    	,area_tot = excluded.area_tot   
    	,latitude = (CASE WHEN t_store_info_test.road_addr = excluded.road_addr THEN t_store_info_test.latitude ELSE NULL END)
    	,longitude = (CASE WHEN t_store_info_test.road_addr = excluded.road_addr THEN t_store_info_test.longitude ELSE NULL END) 
  </insert>
  
  <update id="updateCloseStoreInfo">
  	/* TStoreInfoTest.updateCloseStoreInfo   STORE_INFO 폐업 상점 update */
  	<![CDATA[
	UPDATE 	t_store_info_test	A			
	SET		use_yn = 'N'					
			,del_yn = 'Y'					
	FROM	t_store_info_org B				
	WHERE A.store_mngt_no = B.manage_no  
	AND   B.process_yn = 'N'             
	AND   B.status_type <> '01'     
	]]>     
  </update>
  
  <select id="selectNonExistLatitude" resultMap="BaseResultMap">
  	/* TStoreInfoTest.selectNonExistLatitude   STORE_INFO 좌표없는 상점 조회 */
    select store_seq, store_mngt_no, store_nm, ctgry_nm, road_addr, road_zip, latitude, longitude, 
    company_no, store_open_time, store_end_time, store_holiday_type, max_cnt, file_uuid, 
    use_yn, del_yn, ins_seq, ins_dt, upt_seq, upt_dt, store_tel, area_tot, priority, 
    like_cnt, last_wait_user_seq, last_wait_person_cnt, last_wait_ins_dt, old_addr, old_zip
    from t_store_info_test
    where latitude is null or longitude is null
    and use_yn = 'Y'
    and del_yn = 'N'
  </select>
  
  <update id="updateRoadAddrByPrimaryKey" parameterType="kr.co.infovine.dkmm.db.model.store.TStoreInfoModelTest" >
  	/* TStoreInfoTest.updateRoadAddrByPrimaryKey   STORE_INFO 좌표 및 상세 주소 업데이트 */
  	<![CDATA[
	UPDATE 	t_store_info_test
	SET		latitude = #{latitude,jdbcType=VARCHAR}
			,longitude = #{longitude,jdbcType=VARCHAR}
			,road_addr_detail1 = #{roadAddrDetail1,jdbcType=VARCHAR}
			,road_addr_detail2 = #{roadAddrDetail2,jdbcType=VARCHAR}
			,road_addr_detail3 = #{roadAddrDetail3,jdbcType=VARCHAR}
			,road_addr_detail4 = #{roadAddrDetail4,jdbcType=VARCHAR}
			,road_addr_detail5 = #{roadAddrDetail5,jdbcType=VARCHAR}
			,road_addr_detail6 = #{roadAddrDetail6,jdbcType=VARCHAR}
			,upt_dt = now()
	WHERE store_seq = #{storeSeq,jdbcType=BIGINT}
	]]>     
  </update>
  
</mapper>